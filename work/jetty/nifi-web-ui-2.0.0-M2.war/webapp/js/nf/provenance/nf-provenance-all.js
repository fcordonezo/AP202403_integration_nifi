(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery"],function(c){return(nf.Dialog=b(c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Dialog=b(require("jquery")))}else{nf.Dialog=b(a.$)}}}(this,function(b){b(document).ready(function(){b("#nf-ok-dialog").modal({scrollableContentStyle:"scrollable",handler:{close:function(){b("#nf-ok-dialog-content").empty()}}});b("#nf-yes-no-dialog").modal({scrollableContentStyle:"scrollable",handler:{close:function(){b("#nf-yes-no-dialog-content").empty();b("#nf-yes-no-dialog").modal("setButtonModel",[])}}})});var a={showOkDialog:function(c){c=b.extend({headerText:"",dialogContent:""},c);var d=b("<p></p>").append(c.dialogContent);b("#nf-ok-dialog-content").append(d).append("</br>");b("#nf-ok-dialog").modal("setButtonModel",[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){b("#nf-ok-dialog").modal("hide");if(typeof c.okHandler==="function"){c.okHandler.call(this)}}}}]);b("#nf-ok-dialog").modal("setHeaderText",c.headerText).modal("show")},showYesNoDialog:function(c){c=b.extend({headerText:"",dialogContent:"",yesText:"Yes",noText:"No"},c);var d=b("<p></p>").append(c.dialogContent);b("#nf-yes-no-dialog-content").append(d);b("#nf-yes-no-dialog").modal("setButtonModel",[{buttonText:c.yesText,color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){b("#nf-yes-no-dialog").modal("hide");if(typeof c.yesHandler==="function"){c.yesHandler.call(this)}}}},{buttonText:c.noText,color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){b("#nf-yes-no-dialog").modal("hide");if(typeof c.noHandler==="function"){c.noHandler.call(this)}}}}]);b("#nf-yes-no-dialog").modal("setHeaderText",c.headerText).modal("show")},showDisconnectedFromClusterMessage:function(c){a.showOkDialog({headerText:"Cluster Connection",dialogContent:"This node is currently not connected to the cluster. Any modifications to the data flow made here will not replicate across the cluster.",okHandler:function(){if(typeof c==="function"){c.call(this)}}})},showConnectedToClusterMessage:function(c){a.showOkDialog({headerText:"Cluster Connection",dialogContent:"This node just joined the cluster. Any modifications to the data flow made here will replicate across the cluster.",okHandler:function(){if(typeof c==="function"){c.call(this)}}})}};return a}));
(function(a,b){if(typeof define==="function"&&define.amd){define([],function(){return(nf.AuthorizationStorage=b())})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.AuthorizationStorage=b())}else{nf.AuthorizationStorage=b()}}}(this,function(){var b="Access-Token-Expiration";var a=new RegExp("Request-Token=([^;]+)");return{getRequestToken:function(){var c=null;var d=a.exec(document.cookie);if(d){c=d[1]}return c},getToken:function(){return sessionStorage.getItem(b)},hasToken:function(){var c=this.getToken();return typeof c==="string"},removeToken:function(){sessionStorage.removeItem(b)},setToken:function(c){sessionStorage.setItem(b,c)}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define([],function(){return(nf.Storage=b())})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Storage=b())}else{nf.Storage=b()}}}(this,function(){var h=false;var g=86400000;var f=g*2;var b=function(i){return typeof i==="undefined"};var e=function(i){return i===null};var d=function(i){return !b(i)&&!e(i)};var c=function(k){if(d(k.expires)){var i=new Date(k.expires);var j=new Date();return i.valueOf()<j.valueOf()}else{return false}};var a=function(i){try{var j=JSON.parse(localStorage.getItem(i));if(d(j)){return j}else{return null}}catch(k){return null}};return{init:function(){for(var k=0;k<localStorage.length;k++){try{var j=localStorage.key(k);this.getItem(j)}catch(l){}}},acknowledgeDisconnection:function(){h=true},resetDisconnectionAcknowledgement:function(){h=false},isDisconnectionAcknowledged:function(){return h},setItem:function(j,l,i){i=d(i)?i:new Date().valueOf()+f;var k={expires:i,item:l};localStorage.setItem(j,JSON.stringify(k))},hasItem:function(i){return a(i)!==null},getItem:function(i){var j=a(i);if(j===null){return null}if(c(j)){this.removeItem(i);return null}if(d(j.item)){return j.item}else{return null}},getItemExpiration:function(i){var j=a(i);if(j===null){return null}if(d(j.expires)){return j.expires}else{return null}},removeItem:function(i){localStorage.removeItem(i)}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.AuthorizationStorage","lodash","moment"],function(f,e,c,d,g){return(nf.Common=b(f,e,c,d,g))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Common=b(require("jquery"),require("d3"),require("nf.AuthorizationStorage"),require("lodash"),require("moment")))}else{nf.Common=b(a.$,a.d3,a.nf.AuthorizationStorage,a._,a.moment)}}}(this,function(f,e,b,c,h){f(document).ready(function(){var i="images/bg-error.png";f("<img/>").attr("src",i).on("load",function(){f("div.message-pane").css("background-image",i)});f(document).on("mouseenter","span.link",function(){f(this).addClass("link-over")}).on("mouseleave","span.link",function(){f(this).removeClass("link-over")});f(document).on("click","div.nf-checkbox",function(){var l=f(this);var k=l.hasClass("checkbox-unchecked");var j=l.hasClass("disabled");if(j){return}if(k){l.removeClass("checkbox-unchecked").addClass("checkbox-checked")}else{l.removeClass("checkbox-checked").addClass("checkbox-unchecked")}l.trigger("change",{isChecked:k})});f(document).on("click",".nf-checkbox-label",function(j){f(j.target).parent().find(".nf-checkbox").click()});f(document).ajaxStart(function(){f("div.loading-container").addClass("ajax-loading")}).ajaxStop(function(){f("div.loading-container").removeClass("ajax-loading")});if(b.hasToken()){f("#user-logout-container").css("display","block");g.scheduleTokenRefresh()}f("#user-logout").on("click",function(){f.ajax({type:"DELETE",url:"../nifi-api/access/logout",}).done(function(){b.removeToken();window.location="../nifi/logout"}).fail(nfErrorHandler.handleAjaxError)});f("#user-home").on("click",function(){if(top!==window){parent.window.location="../nifi/"}else{window.location="../nifi/"}})});var d=null;var a=[{text:"view the user interface",value:"flow",description:"Allows users to view the user interface"},{text:"access the controller",value:"controller",description:"Allows users to view/modify the controller including Management Controller Services, Reporting Tasks, Registry Clients, Parameter Providers and nodes in the cluster"},{text:"access parameter contexts",value:"parameter-contexts",description:"Allows users to view/modify Parameter Contexts"},{text:"query provenance",value:"provenance",description:"Allows users to submit a Provenance Search and request Event Lineage"},{text:"access restricted components",value:"restricted-components",description:"Allows users to create/modify restricted components assuming other permissions are sufficient"},{text:"access all policies",value:"policies",description:"Allows users to view/modify the policies for all components"},{text:"access users/user groups",value:"tenants",description:"Allows users to view/modify the users and user groups"},{text:"retrieve site-to-site details",value:"site-to-site",description:"Allows other NiFi instances to retrieve Site-To-Site details of this NiFi"},{text:"view system diagnostics",value:"system",description:"Allows users to view System Diagnostics"},{text:"proxy user requests",value:"proxy",description:"Allows proxy machines to send requests on the behalf of others"},{text:"access counters",value:"counters",description:"Allows users to view/modify Counters"}];var g={ANONYMOUS_USER_TEXT:"Anonymous user",config:{sensitiveText:"Sensitive value set",tooltipConfig:{style:{classes:"nifi-tooltip"},show:{solo:true,effect:function(i){f(this).slideDown(100)}},hide:{effect:function(i){f(this).slideUp(100)}},position:{at:"top center",my:"bottom center"}}},SUPPORTS_SVG:!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,currentUser:undefined,sortVersion:function(j,t){if(j===t){return 0}var p=j.split(/-/);var u=t.split(/-/);if(p.length>=1&&u.length>=1){var r=p[0].split(/\./);var o=u[0].split(/\./);if(r.length>=1&&o.length>=1){var m=Math.min(r.length,o.length);for(var n=0;n<m;n++){var s=parseInt(r[n],10);var l=parseInt(o[n],10);if(isNaN(s)&&isNaN(l)){continue}else{if(isNaN(s)){return -1}else{if(isNaN(l)){return 1}}}if(s!==l){return s-l}}if(r.length===o.length){if(p.length===u.length){var q=g.substringAfterFirst(j,p[0]);var k=g.substringAfterFirst(t,u[0]);return q===k?0:q>k?1:-1}else{return u.length-p.length}}else{return r.length-o.length}}else{if(r.length>=1){return 1}else{if(o.length>=1){return -1}else{return 0}}}}else{if(p.length>=1){return 1}else{if(u.length>=1){return -1}else{return 0}}}},sortType:function(i,l){var j=function(o,m){var p=g.formatBundle(o.bundle);var n=g.formatBundle(m.bundle);return p===n?0:p>n?1:-1};var k=function(t,s){if(i.columnId==="version"){var r=g.isDefinedAndNotNull(t.bundle[i.columnId])?t.bundle[i.columnId]:"";var p=g.isDefinedAndNotNull(s.bundle[i.columnId])?s.bundle[i.columnId]:"";var n=g.sortVersion(r,p);return n===0?j(t,s):n}else{if(i.columnId==="type"){var q=g.substringAfterLast(t[i.columnId],".");var o=g.substringAfterLast(s[i.columnId],".");return q===o?0:q>o?1:-1}else{var m=g.isDefinedAndNotNull(t[i.columnId])?t[i.columnId]:"";var u=g.isDefinedAndNotNull(s[i.columnId])?s[i.columnId]:"";return m===u?j(t,s):m>u?1:-1}}};l.sort(k,i.sortAsc)},typeFormatter:function(n,j,m,l,i){var k="";if(i.restricted===true){k+='<div class="view-usage-restriction fa fa-shield"></div><span class="hidden row-id">'+g.escapeHtml(i.id)+"</span>"}else{k+='<div class="fa"></div>'}k+=g.escapeHtml(m);return k},genericValueFormatter:function(m,j,l,k,i){return g.escapeHtml(l)},typeBundleFormatter:function(m,j,l,k,i){return g.escapeHtml(g.formatBundle(i.bundle))},typeVersionFormatter:function(n,j,m,l,i){var k="";if(g.isDefinedAndNotNull(i.bundle)){k+=('<div style="float: left;">'+g.escapeHtml(i.bundle.version)+"</div>")}else{k+='<div style="float: left;">unversioned</div>'}if(!g.isEmpty(i.controllerServiceApis)){k+='<div class="controller-service-apis fa fa-list" title="Compatible Controller Service" style="margin-left: 4px;"></div><span class="hidden row-id">'+g.escapeHtml(i.id)+"</span>"}k+='<div class="clear"></div>';return k},instanceTypeFormatter:function(m,j,l,k,i){if(!i.permissions.canRead){return""}return g.escapeHtml(g.formatType(i.component))},instanceBundleFormatter:function(m,j,l,k,i){if(!i.permissions.canRead){return""}return g.typeBundleFormatter(m,j,l,k,i.component)},getVersionControlTooltip:function(i){return i.stateExplanation},formatClassName:function(i){return g.substringAfterLast(i.type,".")},formatType:function(i){var j=g.formatClassName(i);if(i.bundle.version!=="unversioned"){j+=(" "+i.bundle.version)}return j},formatBundle:function(i){var j="";if(i.group!=="default"){j=i.group+" - "}return j+i.artifact},setCurrentUser:function(i){g.currentUser=i},scheduleTokenRefresh:function(){if(d!==null){clearInterval(d)}var i=g.MILLIS_PER_MINUTE;var j=function(){var o=b.getToken();if(o!==null){var l=parseInt(o,10)*g.MILLIS_PER_SECOND;var n=new Date(l);var m=new Date();var k=n.valueOf()-m.valueOf()-(30*g.MILLIS_PER_SECOND);if(k<i){if(f("#current-user").text()!==g.ANONYMOUS_USER_TEXT&&!f("#anonymous-user-alert").is(":visible")){f("#anonymous-user-alert").show().qtip(f.extend({},g.config.tooltipConfig,{content:"Your session will expire soon. Please log in again to avoid being automatically logged out.",position:{my:"top right",at:"bottom left"}}))}}}};j();d=setInterval(j,i)},setAnonymousUserLabel:function(){var i=f("#anonymous-user-alert");if(i.data("qtip")){i.qtip("api").destroy(true)}i.show().qtip(f.extend({},g.config.tooltipConfig,{content:"You are accessing with limited authority. Log in or request an account to access with additional authority granted to you by an administrator.",position:{my:"top right",at:"bottom left"}}));f("#current-user").text(g.ANONYMOUS_USER_TEXT).show()},getSessionExpiration:function(j){var k=null;var i=g.getJwtPayload(j);if(i){k=i.exp}return k},getDefaultExpiration:function(){var j=new Date();var i=j.getTime()+43200000;var k=Math.round(i/1000);return k.toString()},getJwtPayload:function(j){if(g.isDefinedAndNotNull(j)){var i=j.split(/\./);if(i.length!==3){return""}var l=f.base64.atob(i[1]);var k=JSON.parse(l);if(g.isDefinedAndNotNull(k)){return k}else{return null}}return null},canVersionFlows:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.canVersionFlows===true}else{return false}},canAccessProvenance:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.provenancePermissions.canRead===true}else{return false}},canAccessRestrictedComponents:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.restrictedComponentsPermissions.canWrite===true}else{return false}},canAccessComponentRestrictions:function(j){if(g.isDefinedAndNotNull(g.currentUser)){if(g.currentUser.restrictedComponentsPermissions.canWrite===true){return true}var i=function(m){if(g.isEmpty(g.currentUser.componentRestrictionPermissions)){return false}var l=false;f.each(g.currentUser.componentRestrictionPermissions,function(n,o){if(o.requiredPermission.id===m.id){if(o.permissions.canWrite===true){l=true;return false}}});return l};var k=true;if(g.isEmpty(j)){k=false}else{f.each(j,function(l,m){if(!i(m.requiredPermission)){k=false;return false}})}return k}else{return false}},canAccessCounters:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.countersPermissions.canRead===true}else{return false}},canModifyCounters:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.countersPermissions.canRead===true&&g.currentUser.countersPermissions.canWrite===true}else{return false}},canAccessTenants:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.tenantsPermissions.canRead===true}else{return false}},canModifyTenants:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.tenantsPermissions.canRead===true&&g.currentUser.tenantsPermissions.canWrite===true}else{return false}},canModifyParameterContexts:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.parameterContextPermissions.canRead===true&&g.currentUser.parameterContextPermissions.canWrite===true}else{return false}},canAccessPolicies:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.policiesPermissions.canRead===true}else{return false}},canModifyPolicies:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.policiesPermissions.canRead===true&&g.currentUser.policiesPermissions.canWrite===true}else{return false}},canAccessController:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.controllerPermissions.canRead===true}else{return false}},canModifyController:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.controllerPermissions.canRead===true&&g.currentUser.controllerPermissions.canWrite===true}else{return false}},canAccessSystem:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.systemPermissions.canRead===true}else{return false}},addHoverEffect:function(i,k,j){f(document).on("mouseenter",i,function(){f(this).removeClass(k).addClass(j)}).on("mouseleave",i,function(){f(this).removeClass(j).addClass(k)});return f(i).addClass(k)},toggleScrollable:function(i){if(f(i).is(":visible")){if(i.offsetHeight<i.scrollHeight||i.offsetWidth<i.scrollWidth){f(i).addClass("scrollable")}else{f(i).removeClass("scrollable")}}},determineContrastColor:function(i){if(parseInt(i,16)>16777215/1.5){return"#000000"}return"#ffffff"},updateLogoutLink:function(){if(b.hasToken()){f("#user-logout-container").css("display","block")}else{f("#user-logout-container").css("display","none")}},isContentViewConfigured:function(){var i=f("#nifi-content-viewer-url").text();return !g.isBlank(i)},populateField:function(j,i){if(g.isUndefined(i)||g.isNull(i)){return f("#"+j).addClass("unset").text("No value set")}else{if(i===""){return f("#"+j).addClass("blank").text("Empty string set")}else{return f("#"+j).text(i)}}},clearField:function(i){return f("#"+i).removeClass("unset blank").text("")},cleanUpTooltips:function(i,j){i.find(j).each(function(){var l=f(this);if(l.data("qtip")){var k=l.qtip("api");k.destroy(true)}})},formatPropertyTooltip:function(j,l){var m=[];if(g.isDefinedAndNotNull(j)){if(!g.isBlank(j.description)){m.push(g.escapeHtml(j.description))}if(!g.isBlank(j.defaultValue)){m.push("<b>Default value:</b> "+g.escapeHtml(j.defaultValue))}if(!g.isBlank(j.supportsEl)){m.push("<b>Expression language scope:</b> "+g.escapeHtml(j.expressionLanguageScope))}if(!g.isBlank(j.sensitive)){m.push("<b>Sensitive property:</b> "+g.escapeHtml(j.sensitive))}if(!g.isBlank(j.identifiesControllerService)){var i=g.formatType({type:j.identifiesControllerService,bundle:j.identifiesControllerServiceBundle});var k=g.formatBundle(j.identifiesControllerServiceBundle);m.push("<b>Requires Controller Service:</b> "+g.escapeHtml(i+" from "+k))}}if(g.isDefinedAndNotNull(l)){if(!g.isEmpty(l.previousValues)){var n=[];f.each(l.previousValues,function(p,o){n.push("<li>"+g.escapeHtml(o.previousValue)+" - "+g.escapeHtml(o.timestamp)+" ("+g.escapeHtml(o.userIdentity)+")</li>")});m.push('<b>History:</b><ul class="property-info">'+n.join("")+"</ul>")}}if(m.length>0){return m.join("<br/><br/>")}else{return null}},formatWhitespaceTooltip:function(){return g.escapeHtml("The specified value contains leading and/or trailing whitespace character(s). This could produce unexpected results if it was not intentional.")},LEAD_TRAIL_WHITE_SPACE_REGEX:/^[ \s]+|[ \s]+$/,hasLeadTrailWhitespace:function(i){if(g.isBlank(i)){return false}return g.LEAD_TRAIL_WHITE_SPACE_REGEX.test(i)},formatProperty:function(i,j){return'<div><span class="label">'+g.formatValue(i)+": </span>"+g.formatValue(j)+"</div>"},formatValue:function(i){if(g.isDefinedAndNotNull(i)){if(i===""){return'<span class="blank" style="font-size: 13px; padding-top: 2px;">Empty string set</span>'}else{return g.escapeHtml(i)}}else{return'<span class="unset" style="font-size: 13px; padding-top: 2px;">No value set</span>'}},escapeHtml:(function(){var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2f;"};return function(j){if(g.isDefinedAndNotNull(j)){return String(j).replace(/[&<>"'\/]/g,function(k){return i[k]})}else{return""}}}()),formatNewLines:function(i){if(g.isDefinedAndNotNull(i)){return i.replaceAll(/[\n]/g,"<br>")}else{return""}},isSensitiveProperty:function(i){if(g.isDefinedAndNotNull(i)){return i.sensitive===true}else{return false}},isRequiredProperty:function(i){if(g.isDefinedAndNotNull(i)){return i.required===true}else{return false}},isDynamicProperty:function(i){if(g.isDefinedAndNotNull(i)){return i.dynamic===true}else{return false}},getAllowableValues:function(i){if(g.isDefinedAndNotNull(i)){return i.allowableValues}else{return null}},supportsEl:function(i){if(g.isDefinedAndNotNull(i)){return i.supportsEl===true}else{return false}},formatUnorderedList:function(j){if(f.isArray(j)){var i=f('<ul class="result"></ul>');f.each(j,function(l,m){var k=f("<li></li>").appendTo(i);if(m instanceof jQuery){k.append(m)}else{k.text(m)}});return i}else{return null}},substringAfterLast:function(m,l){var j="";var k=m.lastIndexOf(l);if(k>=0){var i=k+l.length;if(i<m.length){j=m.substr(i)}}return j},substringAfterFirst:function(m,l){var j="";var k=m.indexOf(l);if(k>=0){var i=k+l.length;if(i<m.length){j=m.substr(i)}}return j},substringBeforeLast:function(l,k){var i="";var j=l.lastIndexOf(k);if(j>=0){i=l.substr(0,j)}return i},substringBeforeFirst:function(l,k){var i="";var j=l.indexOf(k);if(j>=0){i=l.substr(0,j)}return i},setCursor:function(j,i){if(i){f("#"+j).addClass("pointer")}else{f("#"+j).removeClass("pointer")}},MILLIS_PER_DAY:86400000,MILLIS_PER_HOUR:3600000,MILLIS_PER_MINUTE:60000,MILLIS_PER_SECOND:1000,loadBalanceStrategyOptions:[{text:"Do not load balance",value:"DO_NOT_LOAD_BALANCE",description:"Do not load balance FlowFiles between nodes in the cluster."},{text:"Partition by attribute",value:"PARTITION_BY_ATTRIBUTE",description:"Determine which node to send a given FlowFile to based on the value of a user-specified FlowFile Attribute. All FlowFiles that have the same value for said Attribute will be sent to the same node in the cluster."},{text:"Round robin",value:"ROUND_ROBIN",description:"FlowFiles will be distributed to nodes in the cluster in a Round-Robin fashion. However, if a node in the cluster is not able to receive data as fast as other nodes, that node may be skipped in one or more iterations in order to maximize throughput of data distribution across the cluster."},{text:"Single node",value:"SINGLE_NODE",description:"All FlowFiles will be sent to the same node. Which node they are sent to is not defined."}],loadBalanceCompressionOptions:[{text:"Do not compress",value:"DO_NOT_COMPRESS",description:"FlowFiles will not be compressed"},{text:"Compress attributes only",value:"COMPRESS_ATTRIBUTES_ONLY",description:"FlowFiles' attributes will be compressed, but the FlowFiles' contents will not be"},{text:"Compress attributes and content",value:"COMPRESS_ATTRIBUTES_AND_CONTENT",description:"FlowFiles' attributes and content will be compressed"}],formatDuration:function(l){l=l<1?0:l;var n=l/g.MILLIS_PER_DAY;n=n>=1?parseInt(n,10):0;l%=g.MILLIS_PER_DAY;var i=l/g.MILLIS_PER_HOUR;i=i>=1?parseInt(i,10):0;l%=g.MILLIS_PER_HOUR;var j=l/g.MILLIS_PER_MINUTE;j=j>=1?parseInt(j,10):0;l%=g.MILLIS_PER_MINUTE;var m=l/g.MILLIS_PER_SECOND;m=m>=1?parseInt(m,10):0;l=Math.floor(l%g.MILLIS_PER_SECOND);var k=g.pad(i,2,"0")+":"+g.pad(j,2,"0")+":"+g.pad(m,2,"0")+"."+g.pad(l,3,"0");if(n>0){return n+" days and "+k}else{return k}},formatPredictedDuration:function(i){if(i===0){return"now"}return h.duration(i,"ms").humanize()},BYTES_IN_KILOBYTE:1024,BYTES_IN_MEGABYTE:1048576,BYTES_IN_GIGABYTE:1073741824,BYTES_IN_TERABYTE:1099511627776,formatDataSize:function(j){var i=parseFloat(j/g.BYTES_IN_TERABYTE);if(i>1){return i.toFixed(2)+" TB"}i=parseFloat(j/g.BYTES_IN_GIGABYTE);if(i>1){return i.toFixed(2)+" GB"}i=parseFloat(j/g.BYTES_IN_MEGABYTE);if(i>1){return i.toFixed(2)+" MB"}i=parseFloat(j/g.BYTES_IN_KILOBYTE);if(i>1){return i.toFixed(2)+" KB"}return parseFloat(j).toFixed(2)+" bytes"},formatInteger:function(j){var i=j+"";var k=/(\d+)(\d{3})/;while(k.test(i)){i=i.replace(k,"$1,$2")}return g.escapeHtml(i)},formatFloat:function(i){if(g.isUndefinedOrNull(i)){return 0+""}return i.toFixed(2)+""},pad:function(l,j,k){var i=l+"";while(i.length<j){i=k+i}return i},formatDateTime:function(i){return g.pad(i.getMonth()+1,2,"0")+"/"+g.pad(i.getDate(),2,"0")+"/"+g.pad(i.getFullYear(),2,"0")+" "+g.pad(i.getHours(),2,"0")+":"+g.pad(i.getMinutes(),2,"0")+":"+g.pad(i.getSeconds(),2,"0")+"."+g.pad(i.getMilliseconds(),3,"0")},parseDateTime:function(m){if(!g.isDefinedAndNotNull(m)){return new Date()}if(m==="No value set"){return new Date()}if(m==="Empty string set"){return new Date()}var t=m.split(/ /);if(t.length!==3){return new Date()}var j=t[0].split(/\//);var i=t[1].split(/:/);if(j.length!==3||i.length!==3){return new Date()}var o=parseInt(j[2],10);var n=parseInt(j[0],10)-1;var p=parseInt(j[1],10);var q=parseInt(i[0],10);var l=parseInt(i[1],10);var s=i[2].split(/\./);var r=parseInt(s[0],10);var k=0;if(s.length===2){k=parseInt(s[1],10)}return new Date(o,n,p,q,l,r,k)},parseDuration:function(i){var j=i.split(/:/);if(j.length!==3){return 0}var k=j[2].split(/\./);if(k.length===2){return new Date(1970,0,1,parseInt(j[0],10),parseInt(j[1],10),parseInt(k[0],10),parseInt(k[1],10)).getTime()}else{return new Date(1970,0,1,parseInt(j[0],10),parseInt(j[1],10),parseInt(j[2],10),0).getTime()}},parseSize:function(k){var l=k.split(/ /);var j=parseFloat(l[0].replace(/,/g,""));var i=l[1];if(i==="KB"){return j*1024}else{if(i==="MB"){return j*1024*1024}else{if(i==="GB"){return j*1024*1024*1024}else{if(i==="TB"){return j*1024*1024*1024*1024}else{return j}}}}},parseCount:function(k){var j=k.split(/ /,1);if(j.length!==1){return 0}var i=parseInt(j[0].replace(/,/g,""),10);if(isNaN(i)){return 0}return i},isDefinedAndNotNull:function(i){return !g.isUndefined(i)&&!g.isNull(i)},isUndefinedOrNull:function(i){return g.isUndefined(i)||g.isNull(i)},isUndefined:function(i){return typeof i==="undefined"},isBlank:function(i){return g.isUndefined(i)||g.isNull(i)||f.trim(i)===""},isNull:function(i){return i===null},isEmpty:function(i){return f.isArray(i)?i.length===0:true},doBulletinsDiffer:function(k,l){if(f.isArray(k)&&f.isArray(l)){if(k.length===l.length){for(var j=0;j<k.length;j++){if(k[j].id!==l[j].id||k[j].canRead!==l[j].canRead){return true}}}else{return true}}else{if(f.isArray(k)||f.isArray(l)){return true}}return false},getFormattedBulletins:function(j){var i=[];f.each(j,function(l,m){if(m.canRead===true){var k=m.bulletin;var p="";if(g.isDefinedAndNotNull(k.nodeAddress)){p="-&nbsp;"+g.escapeHtml(k.nodeAddress)+"&nbsp;-&nbsp;"}var o=f("<pre></pre>").css({"white-space":"pre-wrap"}).text(k.message);var n=f("<div>"+g.escapeHtml(k.timestamp)+"&nbsp;"+p+"&nbsp;<b>"+g.escapeHtml(k.level)+"</b>&nbsp;</div>").append(o);i.push(n)}});return i},getFormattedServiceApis:function(j){var i=[];f.each(j,function(m,n){var k=g.formatType({type:n.type,bundle:n.bundle});var l=g.formatBundle(n.bundle);i.push(f("<div></div>").text(k+" from "+l))});return i},getFormattedGarbageCollections:function(j){j.sort(function(l,k){return k.collectionCount-l.collectionCount});var i=[];f.each(j,function(m,k){var l=f('<span style="font-weight: bold;"></span>').text(k.name);var n=f("<span></span>").text(" - "+k.collectionCount+" times ("+k.collectionTime+")");var o=f("<div></div>").append(l).append(n);i.push(o)});return i},isGlobalPolicy:function(i){return g.getPolicyTypeListing(i)!==null},getPolicyTypeListing:function(i){return a.find(function(j){return i===j.value})},getComponentName:function(i){return i.permissions.canRead===true?i.component.name:i.id},getComboOptionText:function(i,k){var j=i.find(function(l){return l.value===k});return g.isDefinedAndNotNull(j)?j.text:undefined},throttle:function(i,j){return c.throttle(i,j)},getKeyValue:function(j,i){return i.split(".").reduce(function(l,k){return(typeof l===undefined||l===null)?l:(typeof l[k]=="function")?l[k]():l[k]},j)},isMultiLine:function(i){const j=/\n/.exec(i);if(j){return true}return false},sortParameterContextsAlphabeticallyBasedOnAuthorization:function(m){var j=m.filter(function(n){return n.permissions.canRead});var k=m.filter(function(n){return !n.permissions.canRead});var i=j.sort(function(o,n){if(o.component.name<n.component.name){return -1}if(o.component.name>n.component.name){return 1}return 0});var l=k.sort(function(o,n){if(o.id<n.id){return -1}if(o.id>n.id){return 1}return 0});return i.concat(l)}};return g}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Dialog","nf.Common","nf.AuthorizationStorage"],function(e,d,f,c){return(nf.ErrorHandler=b(e,d,f,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ErrorHandler=b(require("jquery"),require("nf.Dialog"),require("nf.Common"),require("nf.AuthorizationStorage")))}else{nf.ErrorHandler=b(a.$,a.nf.Dialog,a.nf.Common,a.nf.AuthorizationStorage)}}}(this,function(d,c,e,b){var a={handleAjaxError:function(k,f,g){if(f==="canceled"){b.removeToken();if(d("#splash").is(":visible")){d("#message-title").text("Session Expired");d("#message-content").text("Your session has expired. Please reload to log in again.");d("#message-pane").show()}else{c.showOkDialog({headerText:"Session Expired",dialogContent:"Your session has expired. Please press Ok to log in again.",okHandler:function(){window.location="../nifi/"}})}return}var i=k.getResponseHeader("WWW-Authenticate");var j=new RegExp("^Bearer.*$");if(j.test(i)){b.removeToken()}if(d("#splash").is(":visible")){if(k.status===401){d("#message-title").text("Unauthorized")}else{if(k.status===403){d("#message-title").text("Insufficient Permissions")}else{if(k.status===409){d("#message-title").text("Invalid State")}else{if(k.status===413){d("#message-title").text("Payload Too Large")}else{d("#message-title").text("An unexpected error has occurred")}}}}if(d.trim(k.responseText)===""){d("#message-content").text("Please check the logs.")}else{d("#message-content").text(k.responseText)}d("#message-pane").show();return}if(k.status===400||k.status===404||k.status===409||k.status==413||k.status===503){c.showOkDialog({headerText:"Error",dialogContent:e.escapeHtml(k.responseText)})}else{if(k.status===403){c.showOkDialog({headerText:"Insufficient Permissions",dialogContent:e.escapeHtml(k.responseText)})}else{if(k.status<99||k.status===12007||k.status===12029){var h="Please ensure the application is running and check the logs for any errors.";if(e.isDefinedAndNotNull(f)){if(f==="timeout"){h="Request has timed out. Please ensure the application is running and check the logs for any errors."}else{if(f==="abort"){h="Request has been aborted."}else{if(f==="No Transport"){h="Request transport mechanism failed. Please ensure the host where the application is running is accessible."}}}}d("#message-title").text("Unable to communicate with NiFi");d("#message-content").text(h)}else{if(k.status===401){d("#message-title").text("Unauthorized");if(d.trim(k.responseText)===""){d("#message-content").text("Authentication is required to use this NiFi.")}else{d("#message-content").text(k.responseText)}}else{if(k.status===500){d("#message-title").text("An unexpected error has occurred");if(d.trim(k.responseText)===""){d("#message-content").text("An error occurred communicating with the application core. Please check the logs and fix any configuration issues before restarting.")}else{d("#message-content").text(k.responseText)}}else{if(k.status===200||k.status===201){d("#message-title").text("Parse Error");if(d.trim(k.responseText)===""){d("#message-content").text("Unable to interpret response from NiFi.")}else{d("#message-content").text(k.responseText)}}else{d("#message-title").text(k.status+": Unexpected Response");d("#message-content").text("An unexpected error has occurred. Please check the logs.")}}}}d("#message-pane").show()}}},handleConfigurationUpdateAjaxError:function(i,f,g){if(i.status===400){var j=i.responseText.split("\n");var h;if(j.length===1){h=d("<span></span>").text(j[0])}else{h=e.formatUnorderedList(j)}c.showOkDialog({dialogContent:h,headerText:"Configuration Error"})}else{a.handleAjaxError(i,f,g)}}};return a}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery"],function(c){return(nf.UniversalCapture=b(c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.UniversalCapture=b(require("jquery")))}else{nf.UniversalCapture=b(a.$)}}}(this,function(b){b(document).ready(function(c){c(window).on("keydown",function(d){var i=d.ctrlKey||d.metaKey;if(!i&&d.keyCode===27){var g=c("div.value-combo");if(g.is(":visible")&&g.parent().hasClass("combo-editor")){return}if(c("div.property-detail").is(":visible")){a.removeAllPropertyDetailDialogs();d.stopImmediatePropagation();d.preventDefault()}else{var h=c(d.target);if(h.length){var j=c(".cancellable");if(j.length){var e=null;var f=null;c.each(j,function(k,m){var l=c(m);var n=l.css("zIndex");if(l.is(":visible")&&(n!==null&&typeof n!=="undefined")){n=parseInt(n,10);if(e===null||n>e){e=n;f=l}}});if(f!==null){if(f.hasClass("modal")){f.modal("hide")}else{f.hide()}d.stopImmediatePropagation();d.preventDefault();return}}if(top!==window){if(typeof parent.nf!=="undefined"&&typeof parent.nf.Shell!=="undefined"){parent.$("#shell-close-button").click();d.stopImmediatePropagation();d.preventDefault();return}}}}}else{if(i){if(d.keyCode===82){d.preventDefault()}}else{if(!c("input, textarea").is(":focus")&&(d.keyCode==8||d.keyCode===46)){d.preventDefault()}}}})});var a={removeAllPropertyDetailDialogs:function(){var c=b("body").find("div.property-detail");c.find("div.nf-editor").nfeditor("destroy");c.find("div.value-combo").combo("destroy");c.hide().remove()}};return a}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.AuthorizationStorage"],function(d,c){return(nf.AjaxSetup=b(d,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.AjaxSetup=b(require("jquery"),require("nf.AuthorizationStorage")))}else{nf.AjaxSetup=b(a.$,a.nf.AuthorizationStorage)}}}(this,function(b,a){b(document).ready(function(c){c.ajaxSetup({beforeSend:function(e){var d=a.getRequestToken();if(d!==null){e.setRequestHeader("Request-Token",d)}}})})}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["angular"],function(c){return(nf.ng.Bridge=b(c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.Bridge=b(require("angular")))}else{nf.ng.Bridge=b(a.angular)}}}(this,function(a){function b(){this.rootScope;this.injector}b.prototype={constructor:b,call:function(e,d){var h=e.split(".");var i=this.rootScope;a.forEach(h,function(j){i=i[j]});var f=d.split(".");d=this.rootScope;a.forEach(f,function(j){d=d[j]});var g=Array.prototype.slice.call(arguments,2);var c=d.apply(i,g);if(c){return c}},get:function(c){var d=c.split(".");var e=this.rootScope;a.forEach(d,function(f){e=e[f]});return e},digest:function(){this.rootScope.$digest()}};return new b()}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["nf.ng.Bridge","nf.Common","nf.CanvasUtils","nf.ClusterSummary","nf.Actions"],function(e,f,g,c,d){return(nf.ng.AppCtrl=b(e,f,g,c,d))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.AppCtrl=b(require("nf.ng.Bridge"),require("nf.CanvasUtils"),require("nf.Common"),require("nf.ClusterSummary"),require("nf.Actions")))}else{nf.ng.AppCtrl=b(a.nf.ng.Bridge,a.nf.CanvasUtils,a.nf.Common,a.nf.ClusterSummary,a.nf.Actions)}}}(this,function(c,d,e,a,b){return function(g,i){function f(j){this.nf={Common:e,ClusterSummary:a,Actions:b,CanvasUtils:d,};this.serviceProvider=j}f.prototype={constructor:f};var h=new f(i);g.appCtrl=h;c.rootScope=g}}));
(function(a,b){if(typeof define==="function"&&define.amd){define([],function(){return(nf.ng.AppConfig=b())})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.AppConfig=b())}else{nf.ng.AppConfig=b()}}}(this,function(){return function(a,b){b.debugInfoEnabled(false);a.definePalette("basePalette",{"50":"728E9B","100":"728E9B","200":"004849","300":"775351","400":"728E9B","500":"728E9B","600":"728E9B","700":"728E9B","800":"728E9B","900":"rgba(249,250,251,0.97)",A100:"728E9B",A200:"728E9B",A400:"728E9B",A700:"728E9B",contrastDefaultColor:"light",contrastDarkColors:["A100"],contrastLightColors:undefined});a.definePalette("tintPalette",{"50":"728E9B","100":"728E9B","200":"CCDADB","300":"728E9B","400":"AABBC3","500":"728E9B","600":"C7D2D7","700":"728E9B","800":"E3E8EB","900":"728E9B",A100:"728E9B",A200:"728E9B",A400:"728E9B",A700:"728E9B",contrastDefaultColor:"light",contrastDarkColors:["A100"],contrastLightColors:undefined});a.definePalette("warnPalette",{"50":"BA554A","100":"BA554A","200":"BA554A","300":"BA554A","400":"BA554A","500":"BA554A","600":"BA554A","700":"BA554A","800":"BA554A","900":"BA554A",A100:"BA554A",A200:"BA554A",A400:"BA554A",A700:"BA554A",contrastDefaultColor:"light",contrastDarkColors:["A100"],contrastLightColors:undefined});a.theme("default").primaryPalette("basePalette",{"default":"500","hue-1":"200","hue-2":"300","hue-3":"900"}).accentPalette("tintPalette",{"default":"200","hue-1":"400","hue-2":"600","hue-3":"800"}).warnPalette("warnPalette",{"default":"500"})}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","Slick","nf.Common","nf.Dialog","nf.ErrorHandler","nf.Storage","nf.ng.Bridge"],function(f,i,g,e,h,d,c){return(nf.ng.ProvenanceTable=b(f,i,g,e,h,d,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.ProvenanceTable=b(require("jquery"),require("Slick"),require("nf.Common"),require("nf.Dialog"),require("nf.ErrorHandler"),require("nf.Storage"),require("nf.ng.Bridge")))}else{nf.ng.ProvenanceTable=b(a.$,a.Slick,a.nf.Common,a.nf.Dialog,a.nf.ErrorHandler,a.nf.Storage,a.nf.ng.Bridge)}}}(this,function(e,h,f,d,g,c,a){var b=function(u){var A={maxResults:1000,defaultStartTime:"00:00:00",defaultEndTime:"23:59:59",styles:{hidden:"hidden"},urls:{searchOptions:"../nifi-api/provenance/search-options",replays:"../nifi-api/provenance-events/replays",provenance:"../nifi-api/provenance",provenanceEvents:"../nifi-api/provenance-events/",clusterSearch:"../nifi-api/flow/cluster/search-results",d3Script:"js/d3/build/d3.min.js",lineageScript:"js/nf/provenance/nf-provenance-lineage.js"}};var i={};var j=function(H){var F=e("#provenance-event-id").text();var D=A.urls.provenanceEvents+encodeURIComponent(F)+"/content/"+encodeURIComponent(H);var G={};var E=e("#provenance-event-cluster-node-id").text();if(!f.isBlank(E)){G.clusterNodeId=E}if(e.isEmptyObject(G)){window.open(D)}else{window.open(D+"?"+e.param(G))}};var n=function(J){var F=e("#nifi-controller-uri").text();var G=e("#provenance-event-id").text();var D=F+"provenance-events/"+encodeURIComponent(G)+"/content/"+encodeURIComponent(J);var I={};var E=e("#provenance-event-cluster-node-id").text();if(!f.isBlank(E)){I.clusterNodeId=E}if(e.isEmptyObject(I)===false){D=D+"?"+e.param(I)}var H=e("#nifi-content-viewer-url").text();if(H.indexOf("?")===-1){H+="?"}else{H+="&"}var K={ref:D};window.open(H+e.param(K))};var v=function(){e("#event-details-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"Details",tabContentId:"event-details-tab-content"},{name:"Attributes",tabContentId:"attributes-tab-content"},{name:"Content",tabContentId:"content-tab-content"}]});e("#event-details-dialog").modal({scrollableContentStyle:"scrollable",headerText:"Provenance Event",buttons:[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){e("#event-details-dialog").modal("hide")}}}],handler:{close:function(){e("#additional-provenance-details").empty();e("#attributes-container").empty();e("#parent-flowfiles-container").empty();e("#child-flowfiles-container").empty();e("#provenance-event-cluster-node-id").text("");e("#modified-attribute-toggle").removeClass("checkbox-checked").addClass("checkbox-unchecked")},open:function(){f.toggleScrollable(e("#"+this.find(".tab-container").attr("id")+"-content").get(0))}}});e("#modified-attribute-toggle").on("click",function(){var D=e("#attributes-container div.attribute-unmodified");if(D.is(":visible")){e("#attributes-container div.attribute-unmodified").hide()}else{e("#attributes-container div.attribute-unmodified").show()}});e("#input-content-download").on("click",function(){j("input")});e("#output-content-download").on("click",function(){j("output")});if(f.isContentViewConfigured()){e("#input-content-view").on("click",function(){n("input")});e("#output-content-view").on("click",function(){n("output")})}e("#replay-content").on("click",function(){var E={eventId:e("#provenance-event-id").text()};var D=e("#provenance-event-cluster-node-id").text();if(!f.isBlank(D)){E.clusterNodeId=D}e.ajax({type:"POST",url:A.urls.replays,data:JSON.stringify(E),dataType:"json",contentType:"application/json"}).done(function(F){d.showOkDialog({headerText:"Provenance",dialogContent:"Successfully submitted replay request."})}).fail(g.handleAjaxError);e("#event-details-dialog").modal("hide")});e("#replay-details").show()};var s=function(E,D){e("#provenance-search-start-date, #provenance-search-end-date").datepicker({showAnim:"",showOtherMonths:true,selectOtherMonths:true});e("#provenance-search-start-date").datepicker("setDate","+0d");e("#provenance-search-end-date").datepicker("setDate","+0d");e("#provenance-search-start-time").val("00:00:00");e("#provenance-search-end-time").val("23:59:59");e("#provenance-search-minimum-file-size").val("");e("#provenance-search-maximum-file-size").val("");if(E){e("#provenance-search-dialog").height(575);e.ajax({type:"GET",url:A.urls.clusterSearch,dataType:"json"}).done(function(F){var H=F.nodeResults;var G=[{text:"cluster",value:null}];H.sort(function(J,I){var L=J.address.toUpperCase();var K=I.address.toUpperCase();return(L<K)?-1:(L>K)?1:0});e.each(H,function(I,J){G.push({text:J.address,value:J.id})});e("#provenance-search-location").combo({options:G})}).fail(g.handleAjaxError);e("#provenance-search-location-container").show()}e("#provenance-search-dialog").modal({scrollableContentStyle:"scrollable",headerText:"Search Events",buttons:[{buttonText:"Search",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){e("#provenance-search-dialog").modal("hide");var I={};var F=e.trim(e("#provenance-search-start-date").val());var J=e.trim(e("#provenance-search-start-time").val());if(F!==""){if(J===""){J=A.defaultStartTime;e("#provenance-search-start-time").val(J)}I.startDate=F+" "+J+" "+e(".timezone:first").text()}var L=e.trim(e("#provenance-search-end-date").val());var H=e.trim(e("#provenance-search-end-time").val());if(L!==""){if(H===""){H=A.defaultEndTime;e("#provenance-search-end-time").val(H)}I.endDate=L+" "+H+" "+e(".timezone:first").text()}var G=e.trim(e("#provenance-search-minimum-file-size").val());if(G!==""){I.minimumFileSize=G}var M=e.trim(e("#provenance-search-maximum-file-size").val());if(M!==""){I.maximumFileSize=M}if(E){var K=e("#provenance-search-location").combo("getSelectedOption");if(K.value!==null){I.clusterNodeId=K.value}}I.searchTerms=r();D.loadProvenanceTable(I)}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){e("#provenance-search-dialog").modal("hide")}}}]});return e.ajax({type:"GET",url:A.urls.searchOptions,dataType:"json"}).done(function(F){var G=F.provenanceOptions;e.each(G.searchableFields,function(H,I){z(I)})})};var y=function(){e("#provenance-query-dialog").modal({scrollableContentStyle:"scrollable",headerText:"Searching provenance events..."})};var z=function(E){var D=e('<div class="searchable-field"></div>').appendTo("#searchable-fields-container");e('<span class="searchable-field-id hidden"></span>').text(E.id).appendTo(D);e('<div class="searchable-field-name setting-name"></div>').text(E.label).appendTo(D);e('<div class="searchable-field-value"><input type="text" class="searchable-field-input"/></div>').appendTo(D);e('<div class="searchable-checkbox-value nf-checkbox checkbox-unchecked"></div>').appendTo(D);e('<div class="searchable-checkbox-label nf-checkbox-label">Exclude from search results</div>').appendTo(D);e('<div class="searchable-checkbox-tooltip fa fa-question-circle" title="Query for all values except what is entered."></div>').appendTo(D);e('<div class="clear"></div>').appendTo(D);if(E.id==="ProcessorID"){D.find("input").addClass("searchable-component-id")}else{if(E.id==="FlowFileUUID"){D.find("input").addClass("searchable-flowfile-uuid")}}e("#no-searchable-fields").hide()};var r=function(){var D={};e("#searchable-fields-container").children("div.searchable-field").each(function(){var I=e(this);var G=I.children("span.searchable-field-id").text();var J=e.trim(I.find("input.searchable-field-input").val());var H={};if(!f.isBlank(J)){D[G]=H;H.value=J;var E="inverse";var F=I.find("div.searchable-checkbox-value").hasClass("checkbox-checked");if(F==true){H[E]=true}else{H[E]=false}}});return D};var q=function(M,H){e("#provenance-filter").keyup(function(){B()});var F=[{text:"by component name",value:"componentName"},{text:"by component type",value:"componentType"},{text:"by type",value:"eventType"}];if(M){F.push({text:"by node",value:"clusterNodeAddress"})}e("#provenance-filter-type").combo({options:F,select:function(O){B()}});e("#clear-provenance-search").click(function(){e("#searchable-fields-container").find("input.searchable-field-input").each(function(){e(this).val("")});e("#provenance-search-start-date").datepicker("setDate","+0d");e("#provenance-search-end-date").datepicker("setDate","+0d");e("#provenance-search-start-time").val("00:00:00");e("#provenance-search-end-time").val("23:59:59");e("#provenance-search-minimum-file-size").val("");e("#provenance-search-maximum-file-size").val("");if(M){e("#provenance-search-location").combo("setSelectedOption",{text:"cluster"})}i={};H.loadProvenanceTable()});e("#provenance-search-button").click(function(){e("#provenance-search-dialog").modal("show")});var N=function(S,P,R,Q,O){return'<div title="View Details" class="pointer show-event-details fa fa-info-circle"></div>'};var J=function(S,P,R,Q,O){return f.formatValue(R)};var G=(top!==window);var L=function(U,P,T,R,O){var Q="";if(f.SUPPORTS_SVG){Q+='<div title="Show Lineage" class="pointer show-lineage icon icon-lineage"></div>'}var S=O.componentType==="Remote Input Port"||O.componentType==="Remote Output Port";if(G&&f.isDefinedAndNotNull(O.groupId)&&S===false){Q+='<div class="pointer go-to fa fa-long-arrow-right" title="Go To"></div>'}return Q};var I=[{id:"moreDetails",name:"&nbsp;",sortable:false,resizable:false,formatter:N,width:50,maxWidth:50},{id:"eventTime",name:"Date/Time",field:"eventTime",sortable:true,defaultSortAsc:false,resizable:true,formatter:f.genericValueFormatter},{id:"eventType",name:"Type",field:"eventType",sortable:true,resizable:true,formatter:f.genericValueFormatter},{id:"flowFileUuid",name:"FlowFile Uuid",field:"flowFileUuid",sortable:true,resizable:true,formatter:f.genericValueFormatter},{id:"fileSize",name:"Size",field:"fileSize",sortable:true,defaultSortAsc:false,resizable:true,formatter:f.genericValueFormatter},{id:"componentName",name:"Component Name",field:"componentName",sortable:true,resizable:true,formatter:J},{id:"componentType",name:"Component Type",field:"componentType",sortable:true,resizable:true,formatter:f.genericValueFormatter}];if(M){I.push({id:"clusterNodeAddress",name:"Node",field:"clusterNodeAddress",sortable:true,resizable:true,formatter:f.genericValueFormatter})}if(f.SUPPORTS_SVG||G){I.push({id:"actions",name:"&nbsp;",formatter:L,resizable:false,sortable:false,width:50,maxWidth:50})}var E={autosizeColsMode:h.GridAutosizeColsMode.LegacyForceFit,enableTextSelectionOnCells:true,enableCellNavigation:true,enableColumnReorder:false,autoEdit:false,multiSelect:false,rowHeight:24};var D=new h.Data.DataView({inlineFilters:false});H.provenanceData=D;D.setItems([]);D.setFilterArgs({searchString:"",property:"name"});D.setFilter(p);x({columnId:"eventTime",sortAsc:false},D);var K=new h.Grid("#provenance-table",D,I,E);K.setSelectionModel(new h.RowSelectionModel());K.registerPlugin(new h.AutoTooltips());K.setSortColumn("eventTime",false);K.onSort.subscribe(function(P,O){x({columnId:O.sortCol.field,sortAsc:O.sortAsc},D)});K.onClick.subscribe(function(R,O){var Q=e(R.target);var P=D.getItem(O.row);if(K.getColumns()[O.cell].id==="actions"){if(Q.hasClass("show-lineage")){u.showLineage(P.flowFileUuid,P.eventId.toString(),P.clusterNodeId,H)}else{if(Q.hasClass("go-to")){H.goTo(P)}}}else{if(K.getColumns()[O.cell].id==="moreDetails"){if(Q.hasClass("show-event-details")){H.showEventDetails(P.eventId,P.clusterNodeId)}}}});D.onRowCountChanged.subscribe(function(P,O){K.updateRowCount();K.render();e("#displayed-events").text(f.formatInteger(O.current))});D.onRowsChanged.subscribe(function(P,O){K.invalidateRows(O.rows);K.render()});e("#provenance-table").data("gridInstance",K);e("#displayed-events").text("0");e("#total-events").text("0")};var B=function(){var D=e("#provenance-table").data("gridInstance");if(f.isDefinedAndNotNull(D)){var E=D.getData();E.setFilterArgs({searchString:w(),property:e("#provenance-filter-type").combo("getSelectedOption").value});E.refresh()}};var w=function(){return e("#provenance-filter").val()};var p=function(E,D){if(D.searchString===""){return true}try{var G=new RegExp(D.searchString,"i")}catch(F){return false}return E[D.property].search(G)>=0};var x=function(D,F){var E=function(J,H){if(D.columnId==="eventTime"){var L=f.parseDateTime(J[D.columnId]).getTime();var N=f.parseDateTime(H[D.columnId]).getTime();if(L===N){return J.id-H.id}else{return L-N}}else{if(D.columnId==="fileSize"){var G=f.parseSize(J[D.columnId]);var M=f.parseSize(H[D.columnId]);if(G===M){return J.id-H.id}else{return G-M}}else{var I=f.isDefinedAndNotNull(J[D.columnId])?J[D.columnId]:"";var K=f.isDefinedAndNotNull(H[D.columnId])?H[D.columnId]:"";if(I===K){return J.id-H.id}else{return I===K?0:I>K?1:-1}}}};F.sort(E,D.sortAsc)};var k=function(E){var D={provenance:{request:e.extend({maxResults:A.maxResults,summarize:true,incrementalResults:false},E)}};return e.ajax({type:"POST",url:A.urls.provenance,data:JSON.stringify(D),dataType:"json",contentType:"application/json"}).fail(g.handleAjaxError)};var m=function(D){var E=D.uri;if(f.isDefinedAndNotNull(D.request.clusterNodeId)){E+="?"+e.param({clusterNodeId:D.request.clusterNodeId,summarize:true,incrementalResults:false})}else{E+="?"+e.param({summarize:true,incrementalResults:false})}return e.ajax({type:"GET",url:E,dataType:"json"}).fail(g.handleAjaxError)};var l=function(D){var E=D.uri;if(f.isDefinedAndNotNull(D.request.clusterNodeId)){E+="?"+e.param({clusterNodeId:D.request.clusterNodeId})}return e.ajax({type:"DELETE",url:E,dataType:"json"}).fail(g.handleAjaxError)};var t=function(E,H){var K=E.request;var I=E.results;if(f.isDefinedAndNotNull(I.provenanceEvents)){var D=e("#provenance-table").data("gridInstance");var F=D.getData();F.setItems(I.provenanceEvents);F.reSort();D.invalidate();e("#provenance-last-refreshed").text(I.generated);e("#oldest-event").html(f.formatValue(I.oldestEvent));H.serverTimeOffset=I.timeOffset;var J=function(L){return f.isUndefinedOrNull(L.startDate)&&f.isUndefinedOrNull(L.endDate)&&e.isEmptyObject(L.searchTerms)};if(J(K)){var G="Showing the most recent ";if(I.totalCount>=A.maxResults){G+=(f.formatInteger(A.maxResults)+" of "+I.total+" events, please refine the search.")}else{G+=("events.")}e("#provenance-query-message").text(G);e("#clear-provenance-search").hide()}else{var G="Showing ";if(I.totalCount>=A.maxResults){G+=(f.formatInteger(A.maxResults)+" of "+I.total+" events that match the specified query, please refine the search.")}else{G+=("the events that match the specified query.")}e("#provenance-query-message").text(G);e("#clear-provenance-search").show()}e("#total-events").text(f.formatInteger(I.provenanceEvents.length))}else{e("#total-events").text("0")}};function C(){this.serverTimeOffset=null}C.prototype={constructor:C,init:function(E){var D=this;return e.Deferred(function(F){var G=function(J,H,I){F.reject();g.handleAjaxError(J,H,I)};u.init();v();y();q(E,D);s(E,D).done(function(){F.resolve()}).fail(G)}).promise()},resetTableSize:function(){var D=e("#provenance-table").data("gridInstance");if(f.isDefinedAndNotNull(D)){D.resizeCanvas()}},updateProgress:function(F,E){F.find("div.progress-label").remove();F.find("md-progress-linear").remove();var D=e('<div class="progress-label"></div>').text(E+"%");(a.injector.get("$compile")(e('<md-progress-linear ng-cloak ng-value="'+E+'" class="md-hue-2" md-mode="determinate" aria-label="Progress"></md-progress-linear>'))(a.rootScope)).appendTo(F);F.append(D)},loadProvenanceTable:function(J){var H=this;var D=e("#provenance-percent-complete");var G=false;var L=null;var F=null;H.updateProgress(D,0);e("#provenance-query-dialog").modal("setButtonModel",[{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){G=true;if(F!==null){clearTimeout(F);E()}}}}]).modal("show");if(f.isDefinedAndNotNull(J)){i=J}else{if(!e.isEmptyObject(i)){J=i}else{J={}}}var E=function(){if(f.isDefinedAndNotNull(L)){l(L)}e("#provenance-query-dialog").modal("hide")};var I=function(){m(L).done(function(M){L=M.provenance;K()}).fail(E)};var K=function(){if(G===true){E();return}H.updateProgress(D,L.percentCompleted);if(L.finished===true){if(!f.isEmpty(L.results.errors)){var M=L.results.errors;d.showOkDialog({headerText:"Provenance",dialogContent:f.formatUnorderedList(M),})}t(L,H);E()}else{F=setTimeout(function(){F=null;I()},2000)}};k(J).done(function(M){L=M.provenance;K()}).fail(E)},getEventDetails:function(F,E){var D;if(f.isDefinedAndNotNull(E)){D=A.urls.provenanceEvents+encodeURIComponent(F)+"?"+e.param({clusterNodeId:E})}else{D=A.urls.provenanceEvents+encodeURIComponent(F)}return e.ajax({type:"GET",url:D,dataType:"json"}).fail(g.handleAjaxError)},goTo:function(D){if(!Object.hasOwn(D,"componentId")&&Object.hasOwn(D,"id")){D=this.provenanceData.getItemById(D.id)}if(f.isDefinedAndNotNull(D.groupId)){if(top!==window){if(f.isDefinedAndNotNull(parent.nf)&&f.isDefinedAndNotNull(parent.nf.CanvasUtils)&&f.isDefinedAndNotNull(parent.nf.Shell)){parent.nf.CanvasUtils.showComponent(D.groupId,D.componentId);parent.$("#shell-close-button").click()}}}},showEventDetails:function(E,D){o.getEventDetails(E,D).done(function(M){var H=M.provenanceEvent;var P=e("#event-details-tabs").find("li");e(P).each(function(R){if((H.attributes===undefined&&R==1)||(H.inputContentAvailable===undefined&&R==2)){e(this).hide()}else{e(this).show()}});e(P).first().click();e("#provenance-event-id").text(H.eventId);e("#provenance-event-time").html(f.formatValue(H.eventTime)).ellipsis();e("#provenance-event-type").html(f.formatValue(H.eventType)).ellipsis();e("#provenance-event-flowfile-uuid").html(f.formatValue(H.flowFileUuid)).ellipsis();e("#provenance-event-component-id").html(f.formatValue(H.componentId)).ellipsis();e("#provenance-event-component-name").html(f.formatValue(H.componentName)).ellipsis();e("#provenance-event-component-type").html(f.formatValue(H.componentType)).ellipsis();e("#provenance-event-details").html(f.formatValue(H.details)).ellipsis();var K=e("#provenance-event-file-size").html(f.formatValue(H.fileSize)).ellipsis();K.attr("title",f.formatInteger(H.fileSizeBytes)+" bytes");var N=function(S,R){if(f.isDefinedAndNotNull(R)){if(R===0){S.text("< 1ms")}else{S.text(f.formatDuration(R))}}else{S.html('<span class="unset">No value set</span>')}};N(e("#provenance-event-duration"),H.eventDuration);N(e("#provenance-lineage-duration"),H.lineageDuration);var Q=function(R,S){e('<div class="event-detail"></div>').append(e('<div class="detail-name"></div>').text(R)).append(e('<div class="detail-value">'+f.formatValue(S)+"</div>").ellipsis()).append(e('<div class="clear"></div>')).appendTo("#additional-provenance-details")};if(H.eventType==="RECEIVE"){Q("Source FlowFile Id",H.sourceSystemFlowFileId);Q("Transit Uri",H.transitUri)}if(H.eventType==="SEND"){Q("Transit Uri",H.transitUri)}if(H.eventType==="REMOTE_INVOCATION"){Q("Transit Uri",H.transitUri)}if(H.eventType==="ADDINFO"){Q("Alternate Identifier Uri",H.alternateIdentifierUri)}if(H.eventType==="ROUTE"){Q("Relationship",H.relationship)}if(H.eventType==="FETCH"){Q("Transit Uri",H.transitUri)}if(f.isDefinedAndNotNull(H.clusterNodeId)){e("#provenance-event-cluster-node-id").text(H.clusterNodeId);Q("Node Address",H.clusterNodeAddress)}var I=e("#parent-flowfiles-container");var J=e("#child-flowfiles-container");if(f.isEmpty(H.parentUuids)){e("#parent-flowfile-count").text(0);I.append('<span class="unset">No parents</span>')}else{e("#parent-flowfile-count").text(H.parentUuids.length);e.each(H.parentUuids,function(R,S){e("<div></div>").text(S).appendTo(I)})}if(f.isEmpty(H.childUuids)){e("#child-flowfile-count").text(0);J.append('<span class="unset">No children</span>')}else{e("#child-flowfile-count").text(H.childUuids.length);e.each(H.childUuids,function(R,S){e("<div></div>").text(S).appendTo(J)})}var F=e("#attributes-container");e.each(H.attributes,function(R,S){var T=e('<div class="attribute-detail"></div>').append(e('<div class="attribute-name">'+f.formatValue(S.name)+"</div>").ellipsis()).appendTo(F);T.append(e('<div class="attribute-value">'+f.formatValue(S.value)+"</div>").ellipsis()).append('<div class="clear"></div>');if(S.value!==S.previousValue){if(f.isDefinedAndNotNull(S.previousValue)){T.append(e('<div class="modified-attribute-value">'+f.formatValue(S.previousValue)+'<span class="unset"> (previous)</span></div>').ellipsis()).append('<div class="clear"></div>')}else{T.append(e('<div class="unset" style="font-size: 13px; padding-top: 2px;">'+f.formatValue(S.previousValue)+"</div>").ellipsis()).append('<div class="clear"></div>')}}else{T.addClass("attribute-unmodified")}});var G=function(R,S){if(f.isDefinedAndNotNull(S)){R.removeClass("unset").text(S)}else{R.addClass("unset").text("No value previously set")}};e("#input-content-header").text("Input Claim");G(e("#input-content-container"),H.inputContentClaimContainer);G(e("#input-content-section"),H.inputContentClaimSection);G(e("#input-content-identifier"),H.inputContentClaimIdentifier);G(e("#input-content-offset"),H.inputContentClaimOffset);G(e("#input-content-bytes"),H.inputContentClaimFileSizeBytes);var L=e("#input-content-size");G(L,H.inputContentClaimFileSize);if(f.isDefinedAndNotNull(H.inputContentClaimFileSize)){L.attr("title",f.formatInteger(H.inputContentClaimFileSizeBytes)+" bytes")}G(e("#output-content-container"),H.outputContentClaimContainer);G(e("#output-content-section"),H.outputContentClaimSection);G(e("#output-content-identifier"),H.outputContentClaimIdentifier);G(e("#output-content-offset"),H.outputContentClaimOffset);G(e("#output-content-bytes"),H.outputContentClaimFileSizeBytes);var O=e("#output-content-size");G(O,H.outputContentClaimFileSize);if(f.isDefinedAndNotNull(H.outputContentClaimFileSize)){O.attr("title",f.formatInteger(H.outputContentClaimFileSizeBytes)+" bytes")}if(H.inputContentAvailable===true){e("#input-content-download").show();if(f.isContentViewConfigured()){e("#input-content-view").show()}else{e("#input-content-view").hide()}}else{e("#input-content-download").hide();e("#input-content-view").hide()}if(H.outputContentAvailable===true){e("#output-content-download").show();if(f.isContentViewConfigured()){e("#output-content-view").show()}else{e("#output-content-view").hide()}}else{e("#output-content-download").hide();e("#output-content-view").hide()}if(H.replayAvailable===true){e("#replay-content, #replay-content-connection").show();G(e("#replay-connection-id"),H.sourceConnectionIdentifier);e("#replay-content-message").hide()}else{e("#replay-content, #replay-content-connection").hide();e("#replay-content-message").text(H.replayExplanation).show()}e("#event-details-dialog").modal("show")})}};var o=new C();return o};return b}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.Common","nf.Dialog","nf.ErrorHandler"],function(e,c,f,d,g){return(nf.ng.ProvenanceLineage=b(e,c,f,d,g))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.ProvenanceLineage=b(require("jquery"),require("d3"),require("nf.Common"),require("nf.Dialog"),require("nf.ErrorHandler")))}else{nf.ng.ProvenanceLineage=b(a.$,a.d3,a.nf.Common,a.nf.Dialog,a.nf.ErrorHandler)}}}(this,function(d,b,e,c,f){var a=function(){var i={sliderTickCount:75,urls:{lineage:"../nifi-api/provenance/lineage"}};var l=function(){d("#lineage-query-dialog").modal({scrollableContentStyle:"scrollable",headerText:"Computing FlowFile lineage..."})};var g=function(v){var w=document.getElementById("image-download-link");var s=typeof w.download!="undefined";var y="lineage.svg";if(s){var x=self.URL||self.webkitURL||self;var t=new Blob([v],{type:"image/svg+xml;charset=utf-8"});if(window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(t,y)}else{var u=x.createObjectURL(t);w.href=u;w.download=y;w.click()}}else{window.open("data:image/svg+xml;charset=utf-8,"+encodeURI(v))}};var h=function(s){var t=d("#provenance-lineage-context-menu");d.each(s,function(u,w){if(typeof w.click==="function"){var v=d('<div class="context-menu-item"></div>').on("click",w.click).on("mouseenter",function(){d(this).addClass("hover")}).on("mouseleave",function(){d(this).removeClass("hover")}).appendTo(t);d('<div class="context-menu-item-img"></div>').addClass(w["class"]).appendTo(v);d('<div class="context-menu-item-text"></div>').text(w.text).appendTo(v);d('<div class="clear"></div>').appendTo(v)}})};var o=function(s){var t={lineage:{request:s}};return d.ajax({type:"POST",url:i.urls.lineage,data:JSON.stringify(t),dataType:"json",contentType:"application/json"}).fail(f.handleAjaxError)};var p=function(s){var t=s.uri;if(e.isDefinedAndNotNull(s.request.clusterNodeId)){t+="?"+d.param({clusterNodeId:s.request.clusterNodeId})}return d.ajax({type:"GET",url:t,dataType:"json"}).fail(f.handleAjaxError)};var j=function(s){var t=s.uri;if(e.isDefinedAndNotNull(s.request.clusterNodeId)){t+="?"+d.param({clusterNodeId:s.request.clusterNodeId})}return d.ajax({type:"DELETE",url:t,dataType:"json"}).fail(f.handleAjaxError)};var k=100;var n=120;var q=function(G,J,x,B){var w=d("#provenance-lineage");var P=w.width();var L=w.height();var C;var u;var y;var N=new Map();var H=new Map();var T=function(U,W,V){d.each(U,function(X,aa){var Z=N.get(aa);var Y=[];d.each(Z.outgoing,function(ab,ac){Y.push(ac.target.id);W.add(ac.target.id)});if(e.isUndefined(V)){T(Y,W)}else{if(V>1){T(Y,W,V-1)}}})};var z=function(ae,am,ai,ah){var ab=new Set(ae);var al=new Set();var Z=new Set();T(ae,al,1);T(ae,Z);Z.forEach(function(an){ab["delete"](an)});var W=Array.from(al.values()).sort(b.descending);var U=Array.from(ab.values());var ag=0;d.each(U,function(an,ap){var ao=N.get(ap);if(ao.incoming.length>3){ah=n}else{if(ao.incoming.length>=2){ag++}}});if(ag>2){ah=n}if(ai.length===1){U=U.sort(function(ar,aq){var ao=N.get(ar);var an=N.get(aq);if(ao.outgoing.length>0&&an.outgoing.length>0){var ap=W.indexOf(ao.outgoing[0].target.id);var at=W.indexOf(an.outgoing[0].target.id);if(ap!==at){return ap-at}}if(ao.incoming.length>0&&an.incoming.length>0){var ap=ao.incoming[0].source.index;var at=an.incoming[0].source.index;if(ap!==at){return ap-at}}if(ao.type!==an.type){return ao.type>an.type?1:-1}if(ao.eventType!==an.eventType){return ao.eventType>an.eventType?1:-1}return ao.millis-an.millis})}else{if(ai.length>1){U=U.sort(function(ar,aq){var ao=N.get(ar);var an=N.get(aq);if(ao.incoming.length>0&&an.incoming.length>0){var ap=ao.incoming[0].source.index;var at=an.incoming[0].source.index;if(ap!==at){return ap-at}}if(ao.outgoing.length>0&&an.outgoing.length>0){var ap=W.indexOf(ao.outgoing[0].target.id);var at=W.indexOf(an.outgoing[0].target.id);if(ap!==at){return ap-at}}if(ao.type!==an.type){return ao.type>an.type?1:-1}if(ao.eventType!==an.eventType){return ao.eventType>an.eventType?1:-1}return ao.millis-an.millis})}}var ac=P/2;if(ai.length>0){ac=b.mean(ai,function(ao){var an=N.get(ao);return an.x})}var aa=(U.length-1)*k;d.each(U,function(ao,ar){var aq=N.get(ar);aq.y=ah+am-25;if(U.length<=ai.length){if(aq.incoming.length===1){var ap=aq.incoming[0].source;if(ap.outgoing.length===1){aq.x=ap.x;return}}else{if(aq.incoming.length>1){var an=d.grep(aq.incoming,function(at){return(aq.y-at.source.y)<=n});aq.x=b.mean(an,function(at){return at.source.x});return}}}aq.x=(ao*k)+ac-(aa/2)});var ad=U.slice().sort(function(aq,ap){var ao=N.get(aq);var an=N.get(ap);return ao.x-an.x});for(var af=0;af<ad.length-1;af++){var Y=N.get(ad[af]);var ak=N.get(ad[af+1]);var aj=ak.x-Y.x;if(aj<k){ak.x+=(k-aj)}}if(W.length>0){var V=n/3;U=U.sort(function(aq,ap){var ao=N.get(aq);var an=N.get(ap);return ao.x-an.x});var X=0;d.each(U,function(an,ap){var ao=N.get(ap);ao.index=an;if(ao.outgoing.length>3){V=n}else{if(ao.outgoing.length>=2){X++}}});if(X>2){V=n}z(W,ah+am,U,V)}};var R=function(V,U,W){d.each(V,function(X,Y){if(N.has(Y.id)){return}d.extend(Y,{x:0,y:0,visible:true});N.set(Y.id,Y)});d.each(U,function(X,Y){var Z={id:Y.sourceId+"-"+Y.targetId,source:N.get(Y.sourceId),target:N.get(Y.targetId),flowFileUuid:Y.flowFileUuid,millis:Y.millis,visible:true};H.set(Z.id,Z)});v(W)};var v=function(V){var W=new Set(Array.from(N.keys()));N.forEach(function(X,Y){X.outgoing=[];X.incoming=[];if(e.isUndefined(C)||C>X.millis){C=X.millis;u=X.timestamp}if(e.isUndefined(y)||y<X.millis){y=X.millis}});H.forEach(function(X,Y){X.source.outgoing.push(X);X.target.incoming.push(X);W["delete"](X.target.id)});z(Array.from(W.values()),1,[],50);var U=(y-C)/i.sliderTickCount;Q.slider("option","min",C).slider("option","max",y).slider("option","step",U>0?U:1).slider("value",y);d("#event-time").text(F(y,V));A(V)};var F=function(X,Y){var W=new Date();var U=W.getTimezoneOffset()*60*1000;var V=new Date(X+U+Y.serverTimeOffset);return e.formatDateTime(V)};d("#provenance-lineage-context-menu").on("click",function(){d(this).hide().empty()});var S=b.zoom().scaleExtent([0.2,8]).on("zoom",function(U){b.select("g.lineage").attr("transform",function(){return"translate("+U.transform.x+", "+U.transform.y+") scale("+U.transform.k+")"})});var K=b.select("#provenance-lineage-container").append("svg:svg").attr("width","100%").attr("height","100%").call(S).on("dblclick.zoom",null).on("mousedown",function(U,V){b.selectAll("circle.context").classed("context",false);d("#provenance-lineage-context-menu").hide().empty();U.preventDefault()}).on("contextmenu",function(W){var V=d("#provenance-lineage-context-menu");if(!V.is(":empty")){var U=b.pointer(W,this);V.css({left:U[0]+"px",top:U[1]+"px"}).show()}W.preventDefault()});K.append("rect").attr("width","100%").attr("height","100%").attr("fill","#f9fafb");K.append("defs").selectAll("marker").data(["FLOWFILE","FLOWFILE-SELECTED","EVENT","EVENT-SELECTED"]).enter().append("marker").attr("id",function(U){return U}).attr("viewBox","0 -3 6 6").attr("refX",function(U){if(U.indexOf("FLOWFILE")>=0){return 16}else{return 11}}).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").attr("fill",function(U){if(U.indexOf("SELECTED")>=0){return"#ba554a"}else{return"#000000"}}).append("path").attr("d","M0,-3 L6,0 L0,3");var w=K.append("g").attr("transform","translate(0, 0) scale(1)").attr("pointer-events","all").attr("class","lineage");var O=w.selectAll("g.node");var t=w.selectAll("path.link");var E=y;var s=function(Y,Z){if(E>Z.value){var X=O.filter(function(aa){return aa.millis>Z.value&&aa.millis<=E});var W=t.filter(function(aa){return aa.millis>Z.value&&aa.millis<=E});X.transition().delay(200).duration(400).style("opacity",0);W.transition().duration(400).style("opacity",0)}else{var V=O.filter(function(aa){return aa.millis<=Z.value&&aa.millis>E});var U=t.filter(function(aa){return aa.millis<=Z.value&&aa.millis>E});U.transition().delay(200).duration(400).style("opacity",1);V.transition().duration(400).style("opacity",1)}d("#event-time").text(F(Z.value,B));E=Z.value};var Q=d("#provenance-lineage-slider").slider({change:s,slide:s});var I=function(V){V.classed("flowfile",true).on("mousedown",function(W,X){W.stopPropagation()});V.append("circle").attr("r",16).attr("fill","#fff").attr("stroke","#000").attr("stroke-width",1).on("mouseover",function(W,X){t.filter(function(Y){return X.id===Y.flowFileUuid}).classed("selected",true).attr("marker-end",function(Y){return"url(#"+Y.target.type+"-SELECTED)"})}).on("mouseout",function(W,X){t.filter(function(Y){return X.id===Y.flowFileUuid}).classed("selected",false).attr("marker-end",function(Y){return"url(#"+Y.target.type+")"})});var U=V.append("g").attr("class","flowfile-icon").attr("transform",function(W){return"translate(-9,-9)"}).append("text").attr("font-family","flowfont").attr("font-size","18px").attr("fill","#ad9897").attr("transform",function(W){return"translate(0,15)"}).on("mouseover",function(W,X){t.filter(function(Y){return X.id===Y.flowFileUuid}).classed("selected",true).attr("marker-end",function(Y){return"url(#"+Y.target.type+"-SELECTED)"})}).on("mouseout",function(W,X){t.filter(function(Y){return X.id===Y.flowFileUuid}).classed("selected",false).attr("marker-end",function(Y){return"url(#"+Y.target.type+")"})}).text(function(W){return"\ue808"})};var M=function(Z,Y){d("#provenance-lineage-context-menu").hide().empty();var X=[{"class":"lineage-view-event",text:"View details",click:function(){Y.showEventDetails(Z.id,x)}}];if(top!==window){X.push({"class":"lineage-go-to",text:"Go To",click:function(){Y.goTo(Z)}})}if(Z.eventType==="SPAWN"||Z.eventType==="CLONE"||Z.eventType==="FORK"||Z.eventType==="JOIN"||Z.eventType==="REPLAY"){var W=function(ab){var ae=d("#lineage-percent-complete");var af=false;var aa=null;var ah=null;Y.updateProgress(ae,0);d("#lineage-query-dialog").modal("setButtonModel",[{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){af=true;if(ah!==null){clearTimeout(ah);ac()}}}}]).modal("show");var ac=function(){if(e.isDefinedAndNotNull(aa)){j(aa)}d("#lineage-query-dialog").modal("hide")};var ad=function(){p(aa).done(function(ai){aa=ai.lineage;ag()}).fail(ac)};var ag=function(){if(af===true){ac();return}if(!e.isEmpty(aa.results.errors)){var aj=aa.results.errors;c.showOkDialog({headerText:"Process Lineage",dialogContent:e.formatUnorderedList(aj)});ac();return}Y.updateProgress(ae,aa.percentCompleted);if(aa.finished===true){var ai=aa.results;if(ai.nodes.length>0){U(ai)}else{c.showOkDialog({headerText:"Lineage Results",dialogContent:"The lineage search has completed successfully but there no results were found. The events may have aged off."})}ac()}else{ah=setTimeout(function(){ah=null;ad()},2000)}};o(ab).done(function(ai){aa=ai.lineage;ag(1)}).fail(ac)};var U=function(aa){R(aa.nodes,aa.links,Y)};var V=function(aa,ab){ab.getEventDetails(aa,x).done(function(ae){var ad=ae.provenanceEvent;var ag=ad.flowFileUuid;var ah=new Set(ad.childUuids);var ac=function(ak,al){if(ak){return al.id!==aa}else{return al.flowFileUuid!==ag&&d.inArray(Array.from(ag),al.parentUuids)===-1}};var aj=function(ak,al){if(ak){return true}else{return al.flowFileUuid!==ag}};var af=d.inArray(ag,ad.childUuids)>=0;var ai=function(ak){var al=false;d.each(Array.from(N.values()),function(am,an){if(ak.has(an.flowFileUuid)&&ac(af,an)){N["delete"](an.id);d.each(an.outgoing,function(ap,ao){if(!ak.has(ao.flowFileUuid)){ak.add(ao.flowFileUuid);al=true}})}});d.each(Array.from(H.values()),function(am,ao){if(ak.has(ao.flowFileUuid)&&aj(af,ao)){H["delete"](ao.id);var an=ao.target;if(!ak.has(an.flowFileUuid)){ak.add(an.flowFileUuid);al=true}}});if(al){ai(ak)}};ai(ah);v(ab)})};X.push({"class":"lineage-view-parents",text:"Find parents",click:function(){W({lineageRequestType:"PARENTS",eventId:Z.id,clusterNodeId:x})}},{"class":"lineage-view-children",text:"Expand",click:function(){W({lineageRequestType:"CHILDREN",eventId:Z.id,clusterNodeId:x})}},{"class":"lineage-collapse-children",text:"Collapse",click:function(){V(Z.id,Y)}})}h(X)};var D=function(U,V){U.on("contextmenu",function(W,X){b.select("#event-node-"+X.id).classed("context",true);M(X,V)}).on("mousedown",function(W,X){W.stopPropagation()}).on("dblclick",function(W,X){V.showEventDetails(X.id,x)});U.classed("event",true).append("rect").attr("x",0).attr("y",-8).attr("height",16).attr("width",1).attr("opacity",0).attr("id",function(W){return"event-filler-"+W.id});U.append("circle").classed("selected",function(W){return W.id===J}).attr("r",8).attr("fill","#aabbc3").attr("stroke","#000").attr("stroke-width",1).attr("id",function(W){return"event-node-"+W.id});U.append("text").attr("id",function(W){return"event-text-"+W.id}).attr("class","event-type").classed("expand-parents",function(W){return W.eventType==="SPAWN"}).classed("expand-children",function(W){return W.eventType==="SPAWN"}).each(function(Y){var X=b.select(this);if(Y.eventType==="CONTENT_MODIFIED"||Y.eventType==="ATTRIBUTES_MODIFIED"){var W=[];if(Y.eventType==="CONTENT_MODIFIED"){W.push("CONTENT")}else{W.push("ATTRIBUTES")}W.push("MODIFIED");d.each(W,function(aa,Z){X.append("tspan").attr("x","0").attr("dy","1.2em").text(function(){return Z})});X.attr("transform","translate(10,-14)")}else{X.text(Y.eventType).attr("x",10).attr("y",4)}})};var A=function(W){O=O.data(Array.from(N.values()),function(X){return X.id});O.exit().transition().delay(200).duration(400).attr("transform",function(X){if(X.incoming.length===0){return"translate("+(P/2)+",50)"}else{return"translate("+X.incoming[0].source.x+","+X.incoming[0].source.y+")"}}).style("opacity",0).remove();var V=O.enter().append("g").attr("id",function(X){return"lineage-group-"+X.id}).classed("node",true).attr("transform",function(X){if(X.incoming.length===0){return"translate("+(P/2)+",50)"}else{return"translate("+X.incoming[0].source.x+","+X.incoming[0].source.y+")"}}).style("opacity",0);V.filter(function(X){return X.type==="FLOWFILE"}).call(I);V.filter(function(X){return X.type==="EVENT"}).call(D,W);O=O.merge(V);O.transition().duration(400).attr("transform",function(X){return"translate("+X.x+", "+X.y+")"}).style("opacity",1);t=t.data(Array.from(H.values()),function(X){return X.id});t.exit().attr("marker-end","").transition().duration(400).attr("d",function(X){return"M"+X.source.x+","+X.source.y+"L"+X.source.x+","+X.source.y}).style("opacity",0).remove();var U=t.enter().insert("path",".node").attr("class","link").attr("stroke-width",1.5).attr("stroke","#000").attr("fill","none").attr("d",function(X){return"M"+X.source.x+","+X.source.y+"L"+X.source.x+","+X.source.y}).style("opacity",0);t=t.merge(U).attr("marker-end","");t.transition().delay(200).duration(400).attr("marker-end",function(X){return"url(#"+X.target.type+")"}).attr("d",function(X){return"M"+X.source.x+","+X.source.y+"L"+X.target.x+","+X.target.y}).style("opacity",1)};d("#provenance-lineage").show();d("#provenance-event-search").hide();R(G.nodes,G.links,B)};function r(){}r.prototype={constructor:r,init:function(){d("#provenance-lineage-closer").on("click",function(){d("#provenance-lineage svg").remove();d("#provenance-lineage-slider").slider("destroy");d("#provenance-event-search").show();d("#provenance-lineage").hide();d("#provenance-table").data("gridInstance").resizeCanvas()});d("#provenance-lineage-downloader").on("click",function(){var v=d("#provenance-lineage-container").html();var u=d("g.lineage")[0];var x=u.getBBox();var t=x.height+60;var w=x.width+60;var s=x.x-15;var y=x.y-15;v=v.replace(/height=".*?"/,'height="'+t+'"');v=v.replace(/width=".*?"/,'width="'+w+'"');v=v.replace(/transform=".*?"/,"");v=v.replace(/<path([^>]*?)d="M[\s]?([^\s]+?)[\s,]([^\s]+?)[\s]?L[\s]?([^\s]+?)[\s,]([^\s]+?)[\s]?"(.*?)>/g,function(E,I,J,H,G,F,z){if(I.indexOf("link")===-1&&z.indexOf("link")===-1){return E}var D=parseFloat(J)-s;var C=parseFloat(H)-y;var B=parseFloat(G)-s;var A=parseFloat(F)-y;return"<path"+I+'d="M'+D+","+C+"L"+B+","+A+'"'+z+">"});v=v.replace(/<g([^>]*?)transform="translate\([\s]?([^\s]+?)[\s,]([^\s]+?)[\s]?\)"(.*?)>/g,function(C,D,B,A,E){if(D.indexOf("node")===-1&&E.indexOf("node")===-1){return C}var z=parseFloat(B)-s;var F=parseFloat(A)-y;return"<g"+D+'transform="translate('+z+","+F+')"'+E+">"});v=v.replace(/<svg ([^>]*)/,function(A){var B=A;var C=' xmlns="http://www.w3.org/2000/svg"';var D=' xmlns:xlink="http://www.w3.org/1999/xlink"';var z=' version="1.1"';if(B.indexOf(C)===-1){B+=C}if(B.indexOf(D)===-1){B+=D}if(B.indexOf(z)===-1){B+=z}return B});v='<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n'+v;g(v)});l()},showLineage:function(u,s,w,y){var C=d("#lineage-percent-complete");var x=false;var B=null;var v=null;var A={lineageRequestType:"FLOWFILE",uuid:u,clusterNodeId:w,eventId:s};y.updateProgress(C,0);d("#lineage-query-dialog").modal("setButtonModel",[{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){x=true;if(v!==null){clearTimeout(v);t()}}}}]).modal("show");var t=function(){if(e.isDefinedAndNotNull(B)){j(B)}d("#lineage-query-dialog").modal("hide")};var D=function(E){p(B).done(function(F){B=F.lineage;z(E)}).fail(t)};var z=function(E){if(x===true){t();return}if(!e.isEmpty(B.results.errors)){var F=B.results.errors;c.showOkDialog({headerText:"Process Lineage",dialogContent:e.formatUnorderedList(F)});t();return}E.updateProgress(C,B.percentCompleted);if(B.finished===true){q(B.results,s,w,E);t()}else{v=setTimeout(function(){v=null;D(E)},2000)}};o(A).done(function(E){B=E.lineage;z(y)}).fail(t)}};var m=new r();return m};return a}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","angular","nf.Common","nf.ng.AppConfig","nf.ng.AppCtrl","nf.ng.ProvenanceLineage","nf.ng.ProvenanceTable","nf.ng.Bridge","nf.ErrorHandler","nf.Storage"],function(e,j,d,k,i,l,c,g,h,f){return(nf.ng.Provenance=b(e,j,d,k,i,l,c,g,h,f))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.Provenance=b(require("jquery"),require("angular"),require("nf.Common"),require("nf.ng.AppConfig"),require("nf.ng.AppCtrl"),require("nf.ng.ProvenanceLineage"),require("nf.ng.ProvenanceTable"),require("nf.ng.Bridge"),require("nf.ErrorHandler"),require("nf.Storage")))}else{nf.ng.Provenance=b(a.$,a.angular,a.nf.Common,a.nf.ng.AppConfig,a.nf.ng.AppCtrl,a.nf.ng.ProvenanceLineage,a.nf.ng.ProvenanceTable,a.nf.ng.Bridge,a.nf.ErrorHandler,a.nf.Storage)}}}(this,function(d,i,c,j,h,k,b,f,g,e){d(document).ready(function(){var l=i.module("ngProvenanceApp",["ngResource","ngRoute","ngMaterial","ngMessages"]);j.$inject=["$mdThemingProvider","$compileProvider"];h.$inject=["$scope"];a.$inject=["provenanceTableCtrl"];k.$inject=[];b.$inject=["provenanceLineageCtrl"];l.config(j);l.controller("ngProvenanceAppCtrl",h);l.service("provenanceCtrl",a);l.service("provenanceLineageCtrl",k);l.service("provenanceTableCtrl",b);f.injector=i.bootstrap(d("body"),["ngProvenanceApp"],{strictDi:true});f.injector.get("provenanceCtrl").init()});var a=function(o){var n={urls:{clusterSummary:"../nifi-api/flow/cluster/summary",banners:"../nifi-api/flow/banners",about:"../nifi-api/flow/about",currentUser:"../nifi-api/flow/current-user"}};var t=null;var m=function(){return d.ajax({type:"GET",url:n.urls.clusterSummary}).done(function(u){t=u.clusterSummary.connectedToCluster}).fail(g.handleAjaxError)};var l=function(){return d.ajax({type:"GET",url:n.urls.about,dataType:"json"}).done(function(v){var u=v.about;var w=u.title+" Data Provenance";d("#nifi-controller-uri").text(u.uri);d(".timezone").text(u.timezone);if(!c.isBlank(u.contentViewerUrl)){d("#nifi-content-viewer-url").text(u.contentViewerUrl)}document.title=w;d("#provenance-header-text").text(w)}).fail(g.handleAjaxError)};var q=function(){return d.ajax({type:"GET",url:n.urls.currentUser,dataType:"json"}).done(function(u){c.setCurrentUser(u)}).fail(g.handleAjaxError)};var p=function(){d("#refresh-button").click(function(){o.loadProvenanceTable()});return d.Deferred(function(u){if(top===window){d.ajax({type:"GET",url:n.urls.banners,dataType:"json"}).done(function(z){if(c.isDefinedAndNotNull(z.banners)){if(c.isDefinedAndNotNull(z.banners.headerText)&&z.banners.headerText!==""){var w=d("#banner-header").text(z.banners.headerText).show();var y=function(A){var B=d("#"+A);B.css("top",(parseInt(w.css("height"),10)+parseInt(B.css("top"),10))+"px")};y("provenance")}if(c.isDefinedAndNotNull(z.banners.footerText)&&z.banners.footerText!==""){var v=d("#banner-footer").text(z.banners.footerText).show();var x=function(A){var B=d("#"+A);B.css("bottom",parseInt(v.css("height"),10)+"px")};x("provenance")}}u.resolve()}).fail(function(x,v,w){g.handleAjaxError(x,v,w);u.reject()})}else{u.resolve()}}).promise()};function s(){}s.prototype={constructor:s,init:function(){e.init();d.when(l(),q(),m()).done(function(){o.init(t).done(function(){var w={};var x=d("#initial-component-query").text();if(d.trim(x)!==""){d("input.searchable-component-id").val(x);var y={};y.value=x;y.inverse=false;w.ProcessorID=y}var u=d("#initial-flowfile-query").text();if(d.trim(u)!==""){d("input.searchable-flowfile-uuid").val(u);var y={};y.value=u;y.inverse=false;w.FlowFileUUID=y}if(d.isEmptyObject(w)){o.loadProvenanceTable()}else{o.loadProvenanceTable({searchTerms:w})}var v=function(){if(top===window){d("body").css({height:d(window).height()+"px",width:d(window).width()+"px"});d("#provenance").css("margin",40);d("#provenance-refresh-container").css({bottom:"0px",left:"0px",right:"0px"})}o.resetTableSize()};p().done(function(){v()});d(window).on("resize",function(G){v();var z=d(".dialog");for(var E=0,F=z.length;E<F;E++){if(d(z[E]).is(":visible")){setTimeout(function(I){I.modal("resize")},50,d(z[E]))}}var H=d('*[class*="slickgrid_"]');for(var D=0,F=H.length;D<F;D++){if(d(H[D]).is(":visible")){setTimeout(function(I){I.data("gridInstance").resizeCanvas()},50,d(H[D]))}}var B=d(".tab-container");var A=[];for(var C=0,F=B.length;C<F;C++){if(d(B[C]).is(":visible")){A.push(d("#"+d(B[C]).attr("id")+"-content"))}}d.each(A,function(I,J){c.toggleScrollable(J.get(0))})})})})}};var r=new s();return r};return a}));
